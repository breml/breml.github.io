<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Deploy a Go Web App to the Swisscom Application Cloud &middot; breml</title>

  
  <link rel="stylesheet" href="https://breml.github.io/css/poole.css">
  <link rel="stylesheet" href="https://breml.github.io/css/hyde.css">
  <link rel="stylesheet" href="https://breml.github.io/css/poole-overrides.css">
  <link rel="stylesheet" href="https://breml.github.io/css/hyde-overrides.css">
  <link rel="stylesheet" href="https://breml.github.io/css/hyde-x.css">
  <link rel="stylesheet" href="https://breml.github.io/css/breml.css">
  <link rel="stylesheet" href="https://breml.github.io/css/highlight/sunburst.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://breml.github.io/touch-icon-144-precomposed.png">
  <link href="https://breml.github.io/favicon.png" rel="icon">

  
  
  
  

  <meta name="description" content="Howto deploy a Go/Golang web app to the Swisscom Application Cloud.">
  <meta name="keywords" content="Lucas breml Bremgartner blog">
  <link rel="author" href="http://plus.google.com/101218494353589513841">
</head>
<body class="theme-base-0d">
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="https://breml.github.io/"><img src="https://www.gravatar.com/avatar/ffc66df1e22b19865762dc6dc8129ae8?s=200" alt="gravatar"></a>
      <h1>breml</h1>
      <p class="lead">my thoughts about&hellip;</p>
    </div>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item"><a href="https://breml.github.io/">Blog</a></li>
      
      <li class="sidebar-nav-item"><a href="https://breml.github.io/about/">About</a></li>
      
    </ul>

    <p>Categories:<br>
    
    <a class="label" href="/categories/bpf">bpf</a>
    
    <a class="label" href="/categories/elasticsearch">elasticsearch</a>
    
    <a class="label" href="/categories/git">git</a>
    
    <a class="label" href="/categories/gogitignore">gogitignore</a>
    
    <a class="label" href="/categories/golang">golang</a>
    
    <a class="label" href="/categories/sflow">sflow</a>
    
    </p>


    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">
      <a href="https://github.com/breml" target="_blank"><i class="fa fa-github-square fa-3x"></i></a>
      
      <a href="https://www.linkedin.com/in/lucas-bremgartner-96b477" target="_blank"><i class="fa fa-linkedin-square fa-3x"></i></a>
      
      
      
      <a href="https://twitter.com/_breml_" target="_blank"><i class="fa fa-twitter-square fa-3x"></i></a>
      <a href="https://www.xing.com/profile/Lucas_Bremgartner" target="_blank"><i class="fa fa-xing-square fa-3x"></i></a>
      
      <a href="" type="application/rss+xml" target="_blank"><i class="fa fa-rss-square fa-3x"></i></a>
      </li>
    </ul>

    

    <p>Copyright &copy; 2015 <a href="https://breml.github.io/license/">License</a></p>
  </div>
</div>


<div class="content container">
  <div class="post">
    <h1>Deploy a Go Web App to the Swisscom Application Cloud</h1>
    <span class="post-date">Dec 17, 2015 
    
    <br/>
    <a class="label" href="https://breml.github.io/categories/golang">golang</a>
    </span>
    

<p>Inspired by the <a href="https://ict.swisscom.ch/2015/11/push-your-first-node-js-app-into-the-cloud/" target="_blank">this blog post</a> about the deployment of a <a href="https://nodejs.org" target="_blank">node.js</a> example app to the <a href="http://developer.swisscom.com/" target="_blank">Swisscom Application Cloud</a>, I decided to test the Swisscom Application Cloud my self with a similar app, written in Google <a href="https://golang.org" target="_blank">Go</a> language.</p>

<p>This blog should take you through the essential steps on a Linux based system to push your own Go based app to a <a href="https://www.cloudfoundry.org" target="_blank">Cloud Foundry</a> based app cloud, for example the one from Swisscom.</p>

<h2 id="preparations:eea88275f045d0df4893e61c6a42ed5d">Preparations</h2>

<h3 id="go-development-environment:eea88275f045d0df4893e61c6a42ed5d">Go development environment</h3>

<p>I assume you already have a prepared Go development environment. Otherwise I suggest you to start with the <a href="https://golang.org/doc/install" target="_blank">Getting Started</a> manual.</p>

<p>To check, if you have the go tool chain ready, just enter</p>

<pre><code class="language-bash">go env
</code></pre>

<p>this should print something like the below</p>

<pre><code class="language-bash">GOARCH=&quot;amd64&quot;
GOBIN=&quot;&quot;
GOEXE=&quot;&quot;
GOHOSTARCH=&quot;amd64&quot;
GOHOSTOS=&quot;linux&quot;
GOOS=&quot;linux&quot;
GOPATH=&quot;/home/user/go&quot;
GORACE=&quot;&quot;
GOROOT=&quot;/usr/local/go&quot;
GOTOOLDIR=&quot;/usr/local/go/pkg/tool/linux_amd64&quot;
GO15VENDOREXPERIMENT=&quot;0&quot;
CC=&quot;gcc&quot;
GOGCCFLAGS=&quot;-g -O2 -fPIC -m64 -pthread&quot;
CXX=&quot;g++&quot;
CGO_ENABLED=&quot;1&quot;
</code></pre>

<p>If you are using Go in version 1.5.x, you may have set the environment variable <code>GO15VENDOREXPERIMENT=1</code>. For this tutorial I suggest to switch the Go 1.5 vendor experiment off (<code>GO15VENDOREXPERIMENT=0</code>), as this makes our deployment to the app cloud a little bit easier. (Additional information about the hitches with <em>godep</em> and the Go 1.5 vendor experiment could be found in this <a href="https://devcenter.heroku.com/articles/go-support#go-1-5-vendor-experiment" target="_blank">article on heroku</a>.)</p>

<h3 id="godep:eea88275f045d0df4893e61c6a42ed5d">Godep</h3>

<p>Cloud Foundry uses so called <a href="https://docs.developer.swisscom.com/apps/deploy-apps/index.html#buildpacks" target="_blank">buildpacks</a> to provide framework and runtime support for the application. We will later use the <a href="https://github.com/cloudfoundry/go-buildpack" target="_blank">Go buildpack</a> to deploy our web app to the app cloud.</p>

<p>In order to specify the external dependencies (external Go packages) for the Go web app, the above mentioned buildpack uses the tool <a href="https://github.com/tools/godep" target="_blank">Godep</a>.</p>

<p>The installation of Godep is quite straight forward. Just let Go do the work for us:</p>

<pre><code class="language-bash">go get github.com/tools/godep
</code></pre>

<p>This will place the <code>godep</code> command in the directory <code>$GOPATH/bin</code>. If <code>$GOPATH/bin</code> is part of your <code>$PATH</code>, <em>godep</em> is now directly available as command.</p>

<h3 id="cloud-foundry-cli:eea88275f045d0df4893e61c6a42ed5d">Cloud Foundry CLI</h3>

<p>The <a href="https://github.com/cloudfoundry/cli/" target="_blank">Cloud Foundry Command Line Interface (CF CLI)</a> is a command line tool for deploying and managing your applications within the app cloud. You can download the CF CLI from <a href="https://github.com/cloudfoundry/cli/releases/" target="_blank">github.com/cloudfoundry/cli/releases</a>.</p>

<p>The CF CLI tool is written in Go as well and therefore consists of a single static binary. The installation is as simple as download and decompress the executable. For a 64 bit Linux systems, you could use the following commands to download the latest version (6.14.0 as of writing) and to place the executable to the current directory.</p>

<pre><code class="language-bash">curl -L 'https://cli.run.pivotal.io/stable?release=linux64-binary&amp;version=6.14.0&amp;source=github-rel' | tar -xz &gt; cf; chmod +x cf
</code></pre>

<p>To check if everything is working, execute <code>./cf help</code>. For best comfort, you should move the <code>cf</code> binary to a directory within you <code>$PATH</code>.</p>

<p>Alternatively there are installable packages for several OS available as well.</p>

<h2 id="create-the-go-hello-world-web-app:eea88275f045d0df4893e61c6a42ed5d">Create the Go &ldquo;Hello world&rdquo; Web App</h2>

<p>Now we have everything in place to get started with writing the Go version of the &ldquo;Hello world&rdquo; web app.</p>

<p>First you should create a new directory named <em>appcloud</em> within <code>$GOPATH/src</code> and enter it. If you are a <a href="https://github.com/" target="_blank">github.com</a> user, a good choice would be <code>$GOPATH/src/github.com/&lt;your github username&gt;/appcloud</code>. Secondly create a new file named <em>main.go</em> with the following content:</p>

<pre><code class="language-go">package main

import (
	&quot;fmt&quot;
	&quot;log&quot;
	&quot;net/http&quot;
	&quot;os&quot;
)

func helloHandler(w http.ResponseWriter, r *http.Request) {
	fmt.Fprintf(w, &quot;Hello world!&quot;)
}

func main() {
	port := os.Getenv(&quot;PORT&quot;)
	if port == &quot;&quot; {
		port = &quot;3000&quot;
	}

	log.Printf(&quot;Use port: %s\n&quot;, port)

	http.HandleFunc(&quot;/&quot;, helloHandler)
	err := http.ListenAndServe(&quot;:&quot;+port, nil)
	if err != nil {
		log.Panicf(&quot;ListenAndServe error: %v\n&quot;, err)
	}
}
</code></pre>

<p>This program is quite straight forward:</p>

<ul>
<li>We name the package &ldquo;main&rdquo;, because in Go the <em>main</em> package is the entry point for the application.</li>
<li>We import some additional packages from the fantastic Go standard library, which will allow us to listen and answer to web requests.</li>
<li>The function <code>helloHandler</code> will be executed for every request to the web app and will write the famous &ldquo;Hello world&rdquo; to the <code>http.ResponseWriter</code>, which will be returned to the browser of the client.</li>
<li>The <code>main</code> function is where our program starts and where we do some setup:

<ul>
<li>First we collect the TCP Port to bind from the environment variable <code>PORT</code>, because this variable will be set in the app cloud the tell our web app on which TCP port we should bind. If no such environment variable is present, we default to port <em>3000</em>. (Side note: Go expects the port to be a string, because values like <code>http</code> as alias for port 80, are understood by Go as well)</li>
<li>For convenience we log (defaults to stderr) the TCP port, where the web app will bind.</li>
<li>With <code>http.HandleFunc(&quot;/&quot;, helloHandler)</code> we add the function <code>helloHandler</code> as handler function to our web server. Because this is the only handler function and we set the pattern to <code>/</code>, every request to our web app will execute the helloHandler.</li>
<li>The whole &ldquo;start a web server&rdquo; magic happens in the line <code>err := http.ListenAndServe(&quot;:&quot;+port, nil)</code>. With this line our program starts an endless loop to listen on the respective TCP port, on all available IP addresses, and to execute the defined handler functions (in our case there is just one).</li>
</ul></li>
</ul>

<p>That&rsquo;s it for the web app. Now let&rsquo;s have a look, if every thing is working properly.</p>

<p>We can start our web app with the following command:</p>

<pre><code class="language-bash">go run main.go
</code></pre>

<p>Just after starting you should see an output similar to the one below:</p>

<pre><code class="language-plain">2015/12/17 10:58:38 Use port: 3000
</code></pre>

<p>If no other output is printed out, the program is ready to serve HTTP requests. So point your web browser to <a href="http://localhost:3000" target="_blank">http://localhost:3000</a> and enjoy the &ldquo;Hello world!&rdquo; output.</p>

<h2 id="move-into-the-cloud:eea88275f045d0df4893e61c6a42ed5d">Move into the Cloud</h2>

<p>Before we can move our newly build Go based web app to the Swisscom App Cloud, we have to do some preparations:</p>

<ol>
<li>Setup a Swisscom Developer Account</li>
<li>Specify our dependencies with Godep</li>
<li>Create a Cloud Foundry manifest.yml</li>
<li>Upload everything to the cloud</li>
</ol>

<h3 id="setup-a-swisscom-developer-account:eea88275f045d0df4893e61c6a42ed5d">Setup a Swisscom Developer Account</h3>

<p>I don&rsquo;t go into all the details, because they are already outlined in this <a href="https://ict.swisscom.ch/2015/11/push-your-first-node-js-app-into-the-cloud/" target="_blank">blog post</a>.
For the brave, just head to <a href="https://console.developer.swisscom.com/" target="_blank">Swisscom Developer Account</a> and follow the instructions (you will need a credit card in order to precede).</p>

<h3 id="specify-our-dependencies-with-godep:eea88275f045d0df4893e61c6a42ed5d">Specify our Dependencies with Godep</h3>

<p>Even if we don&rsquo;t use any external dependencies, because all used packages belong to the Go standard library, the file, describing the dependencies for our program has still to be present.</p>

<p>This file is auto generated with the command <code>godep save -r</code> (assuming the <em>godep</em> command resides within the <code>$PATH</code>). This will create a new directory named <em>Godeps</em>. Within this directory we find a file called <em>Godeps.json</em> with a content like to following:</p>

<pre><code class="language-json">{
	&quot;ImportPath&quot;: &quot;github.com/breml/appcloud&quot;,
	&quot;GoVersion&quot;: &quot;go1.5.2&quot;,
	&quot;Deps&quot;: []
}
</code></pre>

<p>If you have a properly setup <code>$GOPATH</code> and your web app for the app cloud is placed within the <code>$PATH/src/</code>, everything should be fine.</p>

<p>If this is not the case, for whatever reason you have to manually modify the just generated <code>Godeps/Godeps.json</code> file in order to work with the Go buildpack. Most likely the line with <code>ImportPath</code> reads as follows:</p>

<pre><code class="language-plain">&quot;ImportPath&quot;: &quot;.&quot;,
</code></pre>

<p>In this case the &ldquo;.&rdquo; has to be replaced with the directory name, where your go web app resides. If you have followed the instructions above, your directory is named <em>appcloud</em> and you have to replace the above line with:</p>

<pre><code class="language-plain">&quot;ImportPath&quot;: &quot;appcloud&quot;,
</code></pre>

<h3 id="create-a-cloud-foundry-manifest-yml:eea88275f045d0df4893e61c6a42ed5d">Create a Cloud Foundry manifest.yml</h3>

<p>From the Cloud Foundry <a href="https://docs.developer.swisscom.com/apps/deploy-apps/manifest.html" target="_blank">docs</a> we learn about <em>manifest.yml</em>:</p>

<blockquote>
<p>The application manifest tell the <code>cf push</code> command what to do with applications. This includes everything from how many instances to create and how much memory to allocate to what services applications should use.</p>
</blockquote>

<p>For our small Go web app, we need to provide the following information within the <code>manifest.yml</code>:</p>

<pre><code class="language-plain">---
applications:
- name: DemoApp
  memory: 64M
  host: demoapp&lt;YOURNUMBER&gt;
  buildpack: https://github.com/cloudfoundry/go-buildpack.git
  command: appcloud
</code></pre>

<p>In detail:</p>

<ul>
<li><em>name</em>: name of the app within the app cloud.</li>
<li><em>memory</em>: how much memory should be provided for the app. For our small Go example the minimum setting of 64M is by far enough.</li>
<li><em>host</em>: hostname of the app. This name combined with the assigned domain will be the URL for the app (E. g. demoapp.scapp.io). You should replace <code>&lt;YOURNUMBER&gt;</code> with a random number of yours. If you catch a hostname, which is already taken, you will be notified while pushing the app.</li>
<li><em>buildpack</em>: for Go apps, the recommended buildpack is the mentioned above. This provides framework and runtime support for Go apps.</li>
<li><em>command</em>: Our Go source code, including the respective dependencies managed by <em>Godep</em>, will be compiled while pushing to the app cloud with the provided support by the buildpack. The result will be an executable. The <em>command</em> setting tells the app cloud which program to execute.</li>
</ul>

<h3 id="upload-everything-to-the-cloud:eea88275f045d0df4893e61c6a42ed5d">Upload Everything to the Cloud</h3>

<p>Now with everything set, we may login at the Swisscom App Cloud with:</p>

<pre><code class="language-bash">cf login -a https://api.lyra-836.appcloud.swisscom.com
</code></pre>

<p>and finally deploy our application:</p>

<pre><code class="language-bash">cf push
</code></pre>

<p>If everything is successful, you may now access your &ldquo;Hello world&rdquo; app at <a href="http://demoapp&lt;YOURNUMBER&gt;.scapp.io/" target="_blank">http://demoapp&lt;YOURNUMBER&gt;.scapp.io/</a>.</p>

<h2 id="annex:eea88275f045d0df4893e61c6a42ed5d">Annex</h2>

<p>An extended version of the example, described in this blog post, may be found on <a href="https://github.com/breml/appcloud" target="_blank">github.com/breml/appcloud</a>. Commit <a href="https://github.com/breml/appcloud/tree/dcb5ce9d" target="_blank">dcb5ce9d</a> does correspond to this post.</p>

<p>In the <a href="https://ict.swisscom.ch/2015/11/push-your-first-node-js-app-into-the-cloud/" target="_blank">original post</a> you may find information about scaling your app and combining your app with services.</p>

<h2 id="updates:eea88275f045d0df4893e61c6a42ed5d">Updates</h2>

<h3 id="17-12-2015:eea88275f045d0df4893e61c6a42ed5d">17.12.2015</h3>

<p>Just found out, Go version 1.5 is not supported by the buildpack. Therefore we have to provide the Go version in <code>Godeps/Godeps.json</code> including the minor version (1.5.1 or 1.5.2) even though <em>godep</em> in the latest version suggests to only specify the major version of Go.</p>

<p>Warning by <em>godep</em>:</p>

<pre><code class="language-plain">godep: WARNING: Recorded go version (go1.5.2) with minor version string found.
godep: To record current major go version run `godep update -goversion`.
</code></pre>

  </div>
  
</div>




<script src="https://breml.github.io/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script>
  var _gaq=[['_setAccount','UA-68498959-1'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script>

</body>
</html>

