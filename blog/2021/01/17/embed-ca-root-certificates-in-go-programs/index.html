<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en-us><head><link href=http://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>Embed CA Root Certificates in Go Programs &#183;</title><meta name=description content="The Go package github.com/breml/rootcerts allows to embed the Mozilla CA root certificates in Go programs."><meta name=keywords content="Go,Package,Embed,CA,Root,Certificates,github.com/breml/rootcerts"><link rel=stylesheet href=https://breml.github.io/css/poole.css><link rel=stylesheet href=https://breml.github.io/css/hyde.css><link rel=stylesheet href=https://breml.github.io/css/poole-overrides.css><link rel=stylesheet href=https://breml.github.io/css/hyde-overrides.css><link rel=stylesheet href=https://breml.github.io/css/hyde-x.css><link rel=stylesheet href=https://breml.github.io/css/breml.css><link rel=stylesheet href=https://breml.github.io/css/highlight/sunburst.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface"><link rel=stylesheet href=//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=https://breml.github.io/touch-icon-144-precomposed.png><link href=https://breml.github.io/favicon.png rel=icon></head><body class=theme-base-0d><div class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><a href=https://breml.github.io/><img src="https://www.gravatar.com/avatar/ffc66df1e22b19865762dc6dc8129ae8?s=200" alt=gravatar><h1></h1></a><p class=lead>my thoughts about&mldr;</p></div><ul class=sidebar-nav><li class=sidebar-nav-item><a href=https://breml.github.io/>Blog</a></li><li class=sidebar-nav-item><a href=https://breml.github.io/about/>About</a></li><li class=sidebar-nav-item><a href=https://breml.github.io/links/>Links</a></li></ul><ul class=sidebar-nav><li class=sidebar-nav-item><a href=https://github.com/breml target=_blank><i class="fa fa-github-square fa-3x"></i></a>
<a href=https://www.linkedin.com/in/lucas-bremgartner-96b477 target=_blank><i class="fa fa-linkedin-square fa-3x"></i></a>
<a href=https://www.xing.com/profile/Lucas_Bremgartner target=_blank><i class="fa fa-xing-square fa-3x"></i></a>
<a href=https://bsky.app/profile/breml.bsky.social target=_blank id=bluesky><svg viewBox="0 0 448 512"><path d="M64 32C28.7 32 0 60.7.0 96V416c0 35.3 28.7 64 64 64h320c35.3.0 64-28.7 64-64V96c0-35.3-28.7-64-64-64H64zM224 247.4c14.5-30 54-85.8 90.7-113.3 26.5-19.9 69.3-35.2 69.3 13.7.0 9.8-5.6 82.1-8.9 93.8-11.4 40.8-53 51.2-90 44.9 64.7 11 81.2 47.5 45.6 84-67.5 69.3-97-17.4-104.6-39.6l-.3-.9c-.9-2.6-1.4-4.1-1.8-4.1s-.9 1.5-1.8 4.1c-.1.3-.2.6-.3.9-7.6 22.2-37.1 108.8-104.6 39.6-35.5-36.5-19.1-73 45.6-84-37 6.3-78.6-4.1-90-44.9-3.3-11.7-8.9-84-8.9-93.8.0-48.9 42.9-33.5 69.3-13.7 36.7 27.5 76.2 83.4 90.7 113.3z"/></svg></a>
<a href type=application/rss+xml target=_blank><i class="fa fa-rss-square fa-3x"></i></a></li></ul><p>Categories:<br><a class=label href=/categories/bpf>bpf</a>
<a class=label href=/categories/elasticsearch>elasticsearch</a>
<a class=label href=/categories/git>git</a>
<a class=label href=/categories/gogitignore>gogitignore</a>
<a class=label href=/categories/golang>golang</a>
<a class=label href=/categories/sflow>sflow</a></p><p>Copyright &copy; 2025 <a href=https://breml.github.io/license/>License</a></p></div></div><div class="content container"><div class=post><h1>Embed CA Root Certificates in Go Programs</h1><span class=post-date>Jan 17, 2021<br><a class=label href=https://breml.github.io/categories/golang>golang</a></span><h2 id=abstract>Abstract</h2><p>Package <a href=https://github.com/breml/rootcerts target=_blank>rootcerts</a> provides an embedded copy of the
<a href=https://wiki.mozilla.org/CA/Included_Certificates target=_blank>Mozilla Included CA Certificate List</a>, more specifically the
<a href="https://ccadb-public.secure.force.com/mozilla/IncludedRootsPEMTxt?TrustBitsInclude=Websites" target=_blank>PEM of Root Certificates in Mozilla&rsquo;s Root Store with the Websites (TLS/SSL) Trust Bit Enabled</a>.
If this package is imported anywhere in the program and the <a href=https://golang.org/pkg/crypto/x509/ target=_blank>crypto/x509</a> package cannot find the system certificate
pool, it will use the embedded certificates instead.</p><h2 id=background>Background</h2><p>In my professional work as well as in my private projects I often deploy Go programs as containers. Be it to run them
in the cloud, in K8s or on your local machine. It is pretty common knowledge, how Go programs can be shipped in very
light containers built from <a href=https://docs.docker.com/develop/develop-images/baseimages/ target=_blank>scratch</a>
(e.g. <a href=https://sebest.github.io/post/create-a-small-docker-image-for-a-golang-binary/ target=_blank>Create a small Docker image for a GoLang binary</a>).</p><p>Whenever a Go program does something time and/or HTTPS related, a container build from scratch needed to include some
additional files to work properly. One file is the <a href=https://www.iana.org/time-zones target=_blank>IANA time zone database</a>, the other
is the CA root certificates, often included in a file called <code>ca-certificates.pem</code> (or similar).</p><p>With the release of Go 1.15, the first of these two problems have been resolved by the new <a href=https://golang.org/pkg/time/tzdata/ target=_blank>time/tzdata</a>
package in the Go standard library. If this package is included in a Go program, the IANA time zone database is embedded
and there is no longer a needed to supply this database as an additional file.</p><p><strong>Context switch!</strong></p><p>Since many years, I operate and use small NAS (network attached storage) systems (e.g. by QNAP) to store and backup my
data. All these systems offer SSH access and I used this to run my own selection of tools (e.g. <a href=https://rclone.org/ target=_blank>rclone</a>
, <a href=https://syncthing.net/ target=_blank>syncthing</a>, <a href=https://tailscale.com/ target=_blank>tailscale</a>) on them. All of these tools have in common,
that they are built with Go and with this allow for easy cross compilation to the required CPU architecture (some of
them run on ARM processors).
Unfortunately, over time, some of these NAS systems no longer got operating system updates and with this also the CA
root certificates aged and eventually expired. This made the usage of the before mentioned tools more cumbersome,
because I need to supply the necessary certificates my self and I always need to pass the <code>SSL_CERT_FILE</code> environment
variable when starting one of these tools.</p><h2 id=package-githubcombremlrootcerts>Package github.com/breml/rootcerts</h2><p>When Go 1.15 was released and I learned about the new package <a href=https://golang.org/pkg/time/tzdata/ target=_blank>time/tzdata</a>, I was very happy, because this package
solved a pain for me. Right after, one of my first thoughts has been: &ldquo;we should have a similar package for the CA root
certificates&rdquo;.</p><p>Fast forward some months, I finally took the time to dig into the internal working of the <a href=https://golang.org/pkg/time/tzdata/ target=_blank>time/tzdata</a> as well as the
<a href=https://golang.org/pkg/crypto/x509/ target=_blank>crypto/x509</a> package to figure out, how a similar package could be built,
which allows to embed the CA root certificates in a Go program.</p><p>The result is a new Go package named <a href=https://github.com/breml/rootcerts target=_blank>github.com/breml/rootcerts</a>.</p><p>For the above mentioned use case, where we embed the Go program in a Docker container <code>FROM scratch</code>, we can now
replace the embedding of the CA root certificates in the container with embedding them in the Go program like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Go data-lang=Go><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>_</span> <span style=color:#e6db74>&#34;github.com/breml/rootcerts&#34;</span>
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><p>The same code snipped also makes my life much easier for the tools I use on my NAS systems.</p><h2 id=words-of-caution>Words of Caution</h2><p>The root certificates are the top-most certificates in the trust chain and used to ensure the trustworthiness of the
certificates signed by them either directly (intermediate certificates) or indirectly (through intermediate
certificates). As a user of the <a href=https://github.com/breml/rootcerts target=_blank>github.com/breml/rootcerts</a> package,
you have the obligation to double check the source as well as the integrity of the root certificates provided in this
package. This is absolutely crucial and should not be taken lightly. All certificates that are validated by programs
built upon this package, e.g. by using TLS for communication, rely on the trustworthiness of these root certificates.</p><p>I highly encourage you to read the respective sections in the <a href=https://github.com/breml/rootcerts/blob/master/README.md target=_blank>README.md</a>:</p><ul><li><a href=https://github.com/breml/rootcerts#trustworthiness-of-the-mozilla-included-ca-certificate-list target=_blank>Trustworthiness of the Mozilla Included CA Certificate List</a></li><li><a href=https://github.com/breml/rootcerts#words-of-caution--or-why-you-should-not-use-this-package target=_blank>Words of Caution â€’ or why you should not use this package</a></li></ul></div></div><script src=https://breml.github.io/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad()</script><script type=module>
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';
  mermaid.initialize({ startOnLoad: true });
</script><script>var _gaq=[["_setAccount","UA-68498959-1"],["_trackPageview"]];(function(e,t){var n=e.createElement(t),s=e.getElementsByTagName(t)[0];n.src=("https:"==location.protocol?"//ssl":"//www")+".google-analytics.com/ga.js",s.parentNode.insertBefore(n,s)})(document,"script")</script></body></html>