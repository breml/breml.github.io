<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en-us><head><link href=http://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>Comment Elasticsearch Mapping &#183; breml</title><meta name=description content="Comment Elasticsearch mapping JSON file"><meta name=keywords content="Elasticsearch,mapping,comment,JSON"><link rel=stylesheet href=https://breml.github.io/css/poole.css><link rel=stylesheet href=https://breml.github.io/css/hyde.css><link rel=stylesheet href=https://breml.github.io/css/poole-overrides.css><link rel=stylesheet href=https://breml.github.io/css/hyde-overrides.css><link rel=stylesheet href=https://breml.github.io/css/hyde-x.css><link rel=stylesheet href=https://breml.github.io/css/breml.css><link rel=stylesheet href=https://breml.github.io/css/highlight/sunburst.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface"><link rel=stylesheet href=//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=https://breml.github.io/touch-icon-144-precomposed.png><link href=https://breml.github.io/favicon.png rel=icon></head><body class=theme-base-0d><div class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><a href=https://breml.github.io/><img src="https://www.gravatar.com/avatar/ffc66df1e22b19865762dc6dc8129ae8?s=200" alt=gravatar><h1>breml</h1></a><p class=lead>my thoughts about&mldr;</p></div><ul class=sidebar-nav><li class=sidebar-nav-item><a href=https://breml.github.io/>Blog</a></li><li class=sidebar-nav-item><a href=https://breml.github.io/about/>About</a></li></ul><ul class=sidebar-nav><li class=sidebar-nav-item><a href=https://github.com/breml target=_blank><i class="fa fa-github-square fa-3x"></i></a><a href=https://www.linkedin.com/in/lucas-bremgartner-96b477 target=_blank><i class="fa fa-linkedin-square fa-3x"></i></a><a href=https://twitter.com/_breml_ target=_blank><i class="fa fa-twitter-square fa-3x"></i></a><a href=https://www.xing.com/profile/Lucas_Bremgartner target=_blank><i class="fa fa-xing-square fa-3x"></i></a><a href type=application/rss+xml target=_blank><i class="fa fa-rss-square fa-3x"></i></a></li></ul><p>Categories:<br><a class=label href=/categories/bpf>bpf</a>
<a class=label href=/categories/elasticsearch>elasticsearch</a>
<a class=label href=/categories/git>git</a>
<a class=label href=/categories/gogitignore>gogitignore</a>
<a class=label href=/categories/golang>golang</a>
<a class=label href=/categories/sflow>sflow</a></p><p>Copyright &copy; 2020 <a href=https://breml.github.io/license/>License</a></p></div></div><div class="content container"><div class=post><h1>Comment Elasticsearch Mapping</h1><span class=post-date>Sep 12, 2016<br><a class=label href=https://breml.github.io/categories/elasticsearch>Elasticsearch</a></span><p>If you have worked with large <a href=https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping.html>Elasticsearch mappings</a> you may also have encountered the problem, that there is no possibility to comment your mapping or <a href=https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-templates.html>indexing template</a>. Unfortunately the Elasticsearch mappings as well as the indexing templates are defined in JSON, which does not allow to add comments.</p><p>I thought the same, until I stumbled over <a href=https://github.com/elastic/elasticsearch/issues/1394>Elasticsearch issue 1394</a> and the linked <a href=https://github.com/elastic/elasticsearch/commit/6f7253c5242e7fb94d959ce291c88f93887e3bde>commit from January 2013</a>, where a single line was added to the the configuration of the JSON factory:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>jsonFactory<span style=color:#f92672>.</span><span style=color:#a6e22e>configure</span><span style=color:#f92672>(</span>JsonParser<span style=color:#f92672>.</span><span style=color:#a6e22e>Feature</span><span style=color:#f92672>.</span><span style=color:#a6e22e>ALLOW_COMMENTS</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>);</span>
</code></pre></div><p>Could it really be true? Are there comments supported in Elasticsearch mappings?</p><p>Elasticsearch uses the JSON parser from <a href=https://github.com/FasterXML>FasterXML</a>. The supported features of the FasterXML JSON parser are documented on a <a href=https://github.com/FasterXML/jackson-core/wiki/JsonParser-Features>wiki page</a> on GitHub. On this page, the feature <code>ALLOW_COMMENTS</code> is described as follows:</p><blockquote><p>ALLOW_COMMENTS (default: false) (for textual formats with concept of comments)<br>For textual formats that do not have official comments, but for which &ldquo;de facto&rdquo; conventions exist (like JSON), determines whether use of such unofficial comments is allowed or not<br>Supported for: JSON<br>For JSON: enabling the feature allows recognition and handling of &ldquo;C comments&rdquo; (/* &mldr; */) and &ldquo;C++ comments&rdquo; (// &mldr;.)</p></blockquote><p><strong>YES!</strong> Exactly what we where looking for. The commenting of Elasticsearch mappings does work well with some exceptions. Until now I found the following limitations:</p><ol><li>Comments at the head of the JSON document, before the first opening <code>{</code>-bracket are not working</li><li>Single line comments with <code>//</code> only work at the end of the JSON document (after the closing <code>}</code>)</li></ol><p>But these limitations are minor and easily worked a round.</p><p>To make it easier for others to find out about the possibility to comment Elasticsearch mappings, I filed an <a href=https://github.com/elastic/elasticsearch/issues/20513>issue #20513</a> on Github.</p><p>Example with comments from <a href=https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-templates.html>Elasticsearch documentation</a>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plain data-lang=plain>{
  /* mapping, used for all indices prefixed with &#34;te&#34; */
  &#34;template&#34;: &#34;te*&#34;,
  &#34;settings&#34;: {
    /* only 1 shard is needed */
    &#34;number_of_shards&#34;: 1
  },
  &#34;mappings&#34;: {
    &#34;type1&#34;: {
      &#34;_source&#34;: {
        /* source not needed */
        &#34;enabled&#34;: false
      },
      &#34;properties&#34;: {
        &#34;host_name&#34;: {
          &#34;type&#34;: &#34;string&#34;,
          /* host_name is used as filter, do not analyze */
          &#34;index&#34;: &#34;not_analyzed&#34;
        },
        &#34;created_at&#34;: {
          &#34;type&#34;: &#34;date&#34;,
          &#34;format&#34;: &#34;EEE MMM dd HH:mm:ss Z YYYY&#34;
        }
      }
    }
  }
}
</code></pre></div></div></div><script src=https://breml.github.io/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script><script>var _gaq=[['_setAccount','UA-68498959-1'],['_trackPageview']];(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';s.parentNode.insertBefore(g,s)}(document,'script'));</script></body></html>